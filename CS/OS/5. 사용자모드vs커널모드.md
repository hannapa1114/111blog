### 사용자모드, 커널모드

#### CPU Protection Rings
- CPU 권한 모드
  - 사용자 모드 (user mode by app)
  - 커널 모드 (kernel mode by os): 명령어 실행과 원하는 작업 수행을 위한 자원 접근을 가능케 하는 모드

> kernel이란?
> 1. (견과류|씨앗의) 알맹이
> 2. (사상|주제의) 핵심
> shell이란?
> 1.(달걀|견과류 등의 딱딱한) 껍데기
> 2. 고둥 껍데기 모양의 것

- 사용자 모드(user mode): 응용 프로그램이 사용
- 커널 모드 (kernel mode): OS가 사용

#### 응용 프로그램과 운영체제
- 우리가 만드는 프로그램은 최상위 층에서 돌아감
- 시스템콜은 커널 모드로 실행
  - 커널모드에서만 실행 가능한 기능들이 있음
  - 커널모드로 실행하려면, 반드시 시스템 콜을 사용(거쳐야함)
  - 시스템콜은 운영체제가 제공

![시스템콜](https://user-images.githubusercontent.com/49268125/122144225-fe793900-ce8d-11eb-8858-5d41c2364c22.JPG)

- 응용 프로그램이 전체적인 시스템을 함부로 건드리지 못하게 하기 위함

#### code example 1
```
int main() //1
{
  int fd;
  fd = open("data.txt, O_RDONLY); //2-6
  if(fd == -1) // 7
  {
    printf("Error: cannot open file\n");
    return 1;
  }
  else
  {
    printf("file opened and clodw\n");
    return ();
  }
}
```
1. 사용자 모드에서 프로그램 실행
2. open() 시스템 콜 호출
3. 커널 모드로 전환
4. open()을 처리하는 sys_open()(커널함수) 호출
5. 파일 열기 레벨 연산 수행
6. 사용자 모드로 전환
7. open() 함수 이후의 프로그램 계속 실행

### 정리
- 운영체제는 **시스템 콜** 제공
- 프로그래밍 언어별로 운영체제 기능을 활용하기 위해, 시스템 콜을 기반으로 하는 API 제공
- 응용 프로그램은 운영체제 기능 필요시 해당 API를 사용해서 프로그램을 작성
- 응용 프로그램이 실행되서 운영체제 기능이 필요한 API를 호출하면(시스템 콜이 호출) 커널모드로 변경되어 OS 내부에서 해당 명령이 실행되고 다시 응용 프로그램으로 돌아간다
