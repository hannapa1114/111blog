### 인터럽트

#### 정의
- 프로그램을 실행하고 있을 때 입출력 하드웨어 등의 장치나 예외 상황이 발생하여 처리가 필요할 때 CPU에 알려서 처리하는 기술

#### 필요이유
- 선점형 스케쥴러 구현
  - 프로세스 running 중에 스케쥴러가 이를 중단시키고, 다른 프로세스로 교체하기 위해, 현재 프로세스를 중단시킴
- I/O 디바이스와 커뮤니케이션
  - 저장매체에서 데이터 처리 완료시, 프로세스를 꺠워야 함
- 예외 상황 핸들링 ( 전원차단, I/O 발생 등)
- ex) CPU가 프로그램 실행 시
  - I/O 이슈 발생
    - 파일 처리가 끝났음을 OS에 알려주기
    - OS는 해당 프로세스를 block -> ready 상태로 변경
  - 예외상황 발생
    - 0으로 나누는 계산 발생 시, OS에 알려줘야 함
    - OS가 해당 프로세스 실행 중지/에러 표시

#### 이벤트와 인터럽트
- 인터럽트는 일종의 이벤트로 불림
- 이벤트에 맞게 OS가 처리

#### 주요 인터럽트
- 계산하는 코드에서 0으로 나누는 코드 실행시 (Divide-by-Zero Interrupt)
```
include <stdio.h>

int main()
{
  printf("Hello Wordl!\n);
  int data;
  int divider = 0;
  data = 1 / divider; // 인터럽트 발생
  return 0;
}
```
- 타이머 인터럽트
  - H/W로부터 일정 시간마다 타이머 인터럽트를 OS에 알려줌

- 입출력(I/O) 인터럽트
  - 프린트, 키보드, 마우스, 저장매체 등

#### 인터럽트 종류
- 내부 인터럽트
  - 프로그램 S/W에서 잘못된 명령 or 잘못된 데이터 사용시 발생
    - 0으로 나눴을 때
    - 사용자 모드에서 허용되지 않은 명령, 공간 접근시
    - 계산 결과가 Overflow/Underflow 날 떄
- 외부 인터럽트
  - 주로 H/W에서 발생(프로그램 외부)
    - 전원이상
    - 기계 문제
    - 키보드 등 I/O 관련 이벤트
    - Timer 이벤트

#### 시스템 콜 인터럽트
- 시스템 콜 실행을 위해서는 강제로 코드에 인터럽트 명령을 넣어 CPU에게 실행시켜야 한다.
- 시스템 콜 실제 코드
  - eax 레지스터에 시스템 콜 번호를 넣고
  - ebx 레지스터에 시스템 콜에 해당하는 인자값을 넣고
  - 소프트웨어 인터럽트 명령을 호출하면서 0x80값을 넘겨줌
```
mov eax, 1
mov ebx, 0
int 0x80 // 소프트웨어 인터럽트
```

- 시스템 콜 인터럽트 명령을 호출하면서 0x80값을 넘겨주면
  - CPU는 사용자 모드 -> 커널 모드로 변경
  - IDT(Inteerrupt Descriptor Table)에서 0x80에 해당하는 주소(함수)를 찾아서 실행
  - system_call() 함수에서 eax로부터 시스템 콜 번호를 찾아서 해당 번호에 맞는 시스템 콜 함수로 이동
  - 해당 시스템 콜 함수 실행 후 다시 커널 모드 -> 사용자 모드로 변경, PC값을 참조하여 다음 프로세스 진행

#### 인터럽트와 IDT
- 인터럽트는 미리 정의되어 각각 번호와 실행코드를 가리키는 주소가 기록되어 있음
  - IDT에 기록되어 있음
  - 컴퓨터 부팅시 OS가 기록
  - 운영체제 내부 코드를 기록

- ex) 
  - 인터럽트 발생 시 항상 IDT를 확인
  - 시스템 콜 인터럽트 명령은 0x80 번호가 미리 정의되어 있음
  - 인터럽트 0x80에 해당하는 운영체제 코드는 system_call() 이라는 함수
  - IDT에는 0x80 -> system_call()과 같은 정보가 기록되어 있음

#### 인터럽트와 프로세스
- 프로세스 실행 중 인터럽트 발생
- 현 프로세스 중단
- 인터럽트 처리 함수 실행(OS)
- 현 프로세스 재실행
